<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../../bower_components/paper-toggle-button/paper-toggle-button.html">

<link rel="import" href="../../../bower_components/iron-image/iron-image.html">

<link rel="import" href="../../shared-styles.html">

<dom-module id="draft-card">
  <template>
    <style include="shared-styles">
      .card_link {
        position: relative;
        padding: 16px;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        @apply(--layout);
      }
      paper-icon-button {
        width: 35px;
        height: 35px;
      }

      #card_container{
        @apply(--shadow-elevation-2dp);
        @apply(--shadow-transition);
      }
      #card_container:hover{
        @apply(--shadow-elevation-6dp);
      }

      .container {
        position: relative;
        background-color: var(--app-primary-color);
        height: 200px;
        box-sizing: border-box;
      }
      .container .image {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #EEE;
        opacity: 0.3;
      }
      .container .label {
        font-size: 16px;
        color: white;
      }
      .container .actions {
        padding: 8px;
        width: 100%;
        box-sizing: border-box;
        color: white;
      }
      .container paper-toggle-button {
        --paper-toggle-button-label-color: white;
      }
      .container paper-ripple {
        color: rgba(255, 255, 255, 0.5);
      }
      .container paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      /* Drafts style */
      .draft_container {
        border: 1px dashed #ccc;
        background-color: #fff;
      }
      .draft_container .image {
        opacity: 0.1;
      }
      .draft_container .label {
        color: #555;
      }
      .draft_container .actions {
        color: #888;
      }
      .draft_container paper-toggle-button {
        --paper-toggle-button-label-color: #888;
      }
      .draft_container paper-ripple {
        color: rgba(0, 0, 0, 0.2);
      }
      .draft_container paper-icon-button {
        --paper-icon-button-ink-color: #444;
      }

      @media (max-width: 900px) {
        .container {
          height: 200px;
        }
      }

      @media (max-width: 500px) {
        paper-toggle-button .toggle-label{
          display: none;
        }
      }
      @media (max-width: 400px) {
        .container {
          margin-bottom: 5px;
          height: 150px;
        }
      }
    </style>

    <div id="card_container" class="container layout vertical">
      <iron-image src="{{_generateImage(data.url_img)}}" preload fade sizing="cover" class="image"></iron-image>
      <div class="actions layout horizontal center">
        <template is="dom-if" if="{{isEvent}}" restamp="true">
          <paper-toggle-button noink on-change="_toggleDraft" class="paper-font-body1">
            <template is="dom-if" if="{{showLabel}}" restamp="true">
              PÃºblico
            </template>
          </paper-toggle-button>
        </template>
        <span class="flex"></span>
        <a href="#" class="link">
          <paper-icon-button icon="create" title="Editar"></paper-icon-button>
        </a>
        <paper-icon-button icon="delete" title="Eliminar"></paper-icon-button>
      </div>
      <a href="{{data.slug}}" class="card_link link flex">
        <div class="label paper-font-body2 overflow self-end">{{data.name}}</div>
      </a>
      <paper-ripple></paper-ripple>
    </div>

  </template>
  <script>
    Polymer({
      is: "draft-card",

      properties: {
        data: Object,
        showLabel: Boolean,
        isEvent: Boolean
      },

      attached: function () {
        this._checkDraft();
      },

      _generateImage: function (slug) {
        return "http://localhost:8000" + slug;
      },

      _toggleDraft: function () {
        this.data.activate = !this.data.activate;

        var plan = {
          'id_event': this.data.id,
          'activate': this.data.activate
        };

        this.fire('convert-plan',plan);

        this._checkDraft();
      },
      _checkDraft: function () {
        this.async(function () {
          if (this.data.activate) {
            this.$$("paper-toggle-button").checked = true;
            this.$.card_container.classList.remove('draft_container');
          } else {
            this.$$("paper-toggle-button").checked = false;
            this.$.card_container.classList.add('draft_container');
          }
          this.updateStyles();
        }, 50);
      }
    })
  </script>
</dom-module>
